# 可观测性和观测系统--快速搭建可靠稳定企业级服务的秘诀
可观测行(Observability),是控制理论中一个重要概念。它用来衡量根据系统输出分析系统内部情况的困难程度。观测系统(Monitoring System)是一整套用来检测系统运行情况的系统设施。可观测性的重要程度越来越得到行业界认可。要快速搭建可靠的系统程序来支撑不断增长，不断变化的客户需求，企业需要有效快速的途径了解系统的运行情况。毫不夸张的说，获得系统的可观测性的重要程度不亚于测试程序对项目开发质量，效率的重要性。

测试程序的弱点在于，其输入的复杂度远远不能覆盖现实中应用程序所需处理数据的复杂度，以及多样性。测试程序仅仅只能够帮助开发者验证系统在特定的情况下，能够正确地处理特定的一类问题。可是系统的复杂程度随着系统功能的增强不断增加。同时复杂的系统在复杂的环境中，会出现各种各样令人难以捉摸的系统故障。仅仅通过测试程序，根本无法保障系统能够以足够稳定的方式运行。由于系统故障而导致的服务问题，不仅影响到用户的使用体验，也很大程度损害了公司的品牌形象，对企业的业务，收入，拓展都有着不可小觑的负面效应。

企业级程序系统的复杂度主要来源于几个方面
* 系统的规模。为了能够满足处理日益增长的需求，很多时候，唯一的解决途径是不断添加机器的数目从而保证系统拥有足够的计算能力，及时处理所有信息。维护成白上千台服务器，确保系统正确运行，并非易事。
* 数据的多样性。随着企业业务的增加，系统需要去满足不同客户的需求。这也要求系统能够正确处理各式各样的系统输入。即使再有经验的程序开发人员，也无法提前预知某种会导致系统故障的输入。
* 程序模块的种类。一个庞大的系统往往由一定数目的系统模块组成。一个系统模块实现一种特定功能，负责处理一类特定问题。模块与模块之间，通力合作，以达成客户的各类需求。模块之间的依赖关系，随着模块数目的递增，很快就超过了一个程序员能够掌控的范围。

面临着不断增加的系统复杂程度，依然要保持系统开发的效率，以及服务系统的质量，这对任何一个现代化企业而言，都是一个巨大的难题。

## 如何保障系统的可观测性
在数据化时代的背景下，通过收集有效，可靠的数据是解决各类问题的首选方案。就大型企业级系统开发这个行业而言，相关的数据有两种。第一，系统日志(machine logs)，第二，系统度量(system metrics)。这两者各有各的优势和缺点，**合理搭配使用两者，是保证系统可观测性的秘诀**。

### 系统日志
系统日志以文字明文的形式，记录下相关程序的状态。系统日志为程序开发人员提供最准确的系统信息。要想快速定位系统问题症结所在，唯有通过搜索查询系统日志。对于单机程序开发，使用**grep**和**tail -f**就可以定位问题所在，满足基本需求。企业级开发，则需要一个专门的系统日志管理系统，来处理系统日志庞大的数据量。企业可以选择自己搭建这套系统，不过搭建维护一套稳定的日志管理系统，本身就是一项极具难度的项目工程。因此，比较经济的方式，是使用第三方提供的服务。

系统日志的优点
* 为定位系统问题，提供最有效的程序运行文本信息
* 方便做系统审查，提供最准确的数据，确保保证系统安全
* 为了解系统运行情况，提供关键的上下文

系统日志的缺点
* 庞大的数据量，使得保存搜索系统日志成为一项困难的技术难题。
* 根据系统产生的数据量，企业需要花费一笔可观的费用购买可靠稳定的系统日志管理解决方案。


### 系统度量 
系统度量通过记录数字信息，反应出系统的运行状态。系统度量的优势有如下几点。
* 相比于系统日志，需要更少的存储空间，并且能够快速地被查询。因为它们所需要较小的存储空间，开发者可以选择保存更久的历史数据。
* 利用数字信息，方便创建仪表盘，反应显示系统状态的趋势。
* 根据系统度量，开发者能够很方便的设置各种预警机制。
* 除非需要新增加机器，系统度量不会因为系统需要处理更多请求而产生更多额外数据。

系统度量的缺点在于，仅仅根据几项数字指标，无法发现系统症结所在。另外第一代度量数据系统Graphite，没有标签的概念，从而导致数据查询中纬度选择的困难。第二代系统度量中，引进了标签的概念。在很大程度上改进第一代的缺陷。

### 总结
搭配使用系统日志和系统度量，从而拥有一套完善的检测系统是保证系统可测性的关键。在信息化时代，企业在不断开发服务产品的过程中，需要保证系统的可测性，这样才能确保系统开发的效率和质量。

最后，安利一下自己所在的公司[Sumo Logic](https://www.sumologic.com/)的基于公有云的产品。每日处理**100PB数据，2千万搜索**。如果你的企业准备在海外搭建基于AWS，Azure的云服务，我们公司的产品能够为你提供最安全，最有效的系统监测服务，保证你对系统拥有足够的掌控。如果你想获得更多的信息，欢迎访问[公司主页](https://www.sumologic.com/)或者邮件联系我(zhong@sumologic.com)。

相关文章
* [Logs and Metrics](https://medium.com/@copyconstruct/logs-and-metrics-6d34d3026e38)
